<?php
/** @var Magento\Framework\View\Element\Template $block */
/** @var Superpayments\SuperPayment\ViewModel\MarketingBanner $viewModel */
/** @var \Magento\Framework\Escaper $escaper */

$viewModel = $block->getData('view_model');

if ($viewModel->getPdpBanner()):
    /** @var \Magento\Catalog\Model\Product|null $product */
    $product = $block->getProduct();

    if ($product) {
        $price = $product->getFinalPrice();
        if ($price === null || $price === '' || $price === false) {
            $price = $product->getData('final_price') ?? $product->getData(\Magento\Catalog\Api\Data\ProductInterface::PRICE);
        }
        $priceMinor = (string)(int)$viewModel->getPriceConverter()->minorUnitAmount((float)$price);
    } else {
        $priceMinor = '0';
    }

    $bannerData = $viewModel->getWebComponentData('product-detail', true);
    $page   = (string)($bannerData['page'] ?? '');
    $cartId = (string)($bannerData['cart']['id'] ?? '');
    ?>
    <div style="clear: both;"></div>
    <div class="super-container">
        <style>
            .super-container div[style] {
                font-size: 13px;
            }
            .box-tocart .actions {
                display: inline !important;
            }
        </style>
        <super-product-callout
            page="<?= $escaper->escapeHtmlAttr($page); ?>"
            cartId="<?= $escaper->escapeHtmlAttr($cartId); ?>"
            productAmount="<?= $escaper->escapeHtmlAttr($priceMinor); ?>"
            productQuantity="1"
        ></super-product-callout>
    </div>
<?php endif; ?>
